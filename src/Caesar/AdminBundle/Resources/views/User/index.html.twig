{% extends "CaesarAdminBundle::layout.html.twig" %}

{% block stylesheets %}
    {{parent()}}
<link rel="stylesheet" type="text/css" href="{{ asset('css/table.css') }}" />
{% endblock %}

{% block breadCrumb%}
    {{parent()}}
<li data-header="1" class="active"><span>{{'admin.breadcrumb.users.list'|trans({})}}</span></li>
{% endblock %}

{% block contentTitle %}{{'admin.title.users.list'|trans({})}}{% endblock %}

{% block contentBody %}
<table class="table table-hover table-bordered table-striped">
    <thead>
        <tr>
            <th{% if 'codeBu' == sort %} class="sorted"{% endif %}>
                {% include ':Pagination:sortable.html.twig' with {'title' : 'table.title.users.codeBu'|trans({}), 'page': page, 'sort': 'codeBu'}  %}
            </th>
            <th{% if 'login' == sort %} class="sorted"{% endif %}>
                    {% include ':Pagination:sortable.html.twig' with {'title' : 'table.title.users.login'|trans({}), 'page': page, 'sort': 'login'}  %}
            </th>
            <th{% if 'nom' == sort %} class="sorted"{% endif %}>
                {% include ':Pagination:sortable.html.twig' with {'title' : 'table.title.users.nom'|trans({}), 'page': page, 'sort': 'nom'}  %}
            </th>
            <th{% if 'prenom' == sort %} class="sorted"{% endif %}>
                {% include ':Pagination:sortable.html.twig' with {'title' : 'table.title.users.prenom'|trans({}), 'page': page, 'sort': 'prenom'}  %}
            </th>
            <th{% if 'email' == sort %} class="sorted"{% endif %}>
                {% include ':Pagination:sortable.html.twig' with {'title' : 'table.title.users.email'|trans({}), 'page': page, 'sort': 'email'}  %}
            </th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tfoot>
        <tr>
            <td colspan="7">
                {{ 'table.foot.count.text'|trans({'%value%': count}) }}
            </td>
        </tr>
    </tfoot>
    <tbody id="table_list">
        {% include 'CaesarAdminBundle:User:list.html.twig' with {'users' : users}  %}
    <tbody>
</table>

{# display navigation #}

	<div class="navigation">
		<ul>
			{# Affichage des boutons "Précédent" et "Première page" (si page > 1) #}
            {% if pagination.cur > 1 %}
            <li><a class="_pagination" href="{{ path('caesar_admin_user_homepage', {'page':pagination.cur-1}) }}" title="{{ "pagination.prev"|trans({}, 'CaesarAdminBundle') }}"><</a></li>
            <li><a class="_pagination" href="{{ path('caesar_admin_user_homepage', {'page':1}) }}" title="{{ "pagination.first"|trans({}, 'CaesarAdminBundle') }}"><<</a></li>
            {% endif %}
            
            {# Affichage des boutons vers les 3 pages précédent la page courante (ou 2, ou 1, ou 0) #}
            {% for i in 3 .. 1 %}
	            {% if pagination.cur - i > 0 %}
	            <li><a class="_pagination" href="{{ path('caesar_admin_user_homepage', {'page':pagination.cur - i}) }}">{{ pagination.cur - i }}</a></li>
	            {% endif %}
            {% endfor %}
            
            {# Affichage de la page courante #}
            <li class="active"><a class="_pagination" href="{{ path('caesar_admin_user_homepage', {'page':pagination.cur}) }}">{{ pagination.cur }}</a></li> 
            
            {# Affichage des 3 (ou 2, ou 1, ou 0) pages suivant la page courante #}
            {% for i in 1 .. 3 %}
	            {% if pagination.cur + i <= pagination.max %}
	            <li><a class="_pagination" href="{{ path('caesar_admin_user_homepage', {'page':pagination.cur + i}) }}">{{ pagination.cur + i }}</a></li>
	            {% endif %}
            {% endfor %}
            
			{# Affichage des boutons "Suivant" et "Dernière page" (si page différente du max de page ) #}
            {% if pagination.cur <= pagination.max %}
            <li><a class="_pagination" href="{{ path('caesar_admin_user_homepage', {'page':pagination.max}) }}" title="{{ "pagination.last"|trans({}, 'CaesarAdminBundle') }}">>></a></li>
            <li><a class="_pagination" href="{{ path('caesar_admin_user_homepage', {'page':pagination.cur+1}) }}" title="{{ "pagination.next"|trans({}, 'CaesarAdminBundle') }}">></a></li>
            {% endif %}
        </ul>
	</div>
{% endblock %}
{% block javascripts %}
{{parent()}}
            <script type="text/javascript" src="{{ asset('js/jquery.blockUI.js') }}" ></script>
            <script type="text/javascript" src="{{ asset('js/sort.js') }}" ></script>
            <script type="text/javascript">
                message = "{{'ajax.wait.message'|trans({})}}";
                /* Pagination */
                $(document).ready(function() {
                	var processing = false;
	                $("._pagination").live("click", function(e){
			            if (processing) return false;
			            processing = true;
			            $.ajax({
			                type: "GET",
			                url: $(this).attr('href'),
			                cache: false,
			                success: function(data){
			                 	$('#table_list').html(data);
			                    processing = false;
			                },
			                error: function(xhr, ajaxOptions, thrownError) {
			                	$('#table_list').html('Une erreur est survenue');
			                    processing = false;
			                }
			            });
			            return false; // Empêche la redirection normale
			        });
                });
            </script>
{% endblock %}
